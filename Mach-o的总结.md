
---
title: 模块化和解耦
date: 2018-11-18 22:13:29
tags: iOS
---


## 解析 MACH_O 文件
这篇文章描述了如何解析 Mach-O 文件并稍微解释了一下它的格式。这不是一份权威指南，不过当你不知从何开始时，它可能有些帮助。想了解更多信息，请考虑阅读官方文档和操作系统提供的头文件。

Macho-O 是什么

Mach-O 是 Mach object 文件格式的缩写，它是一种用于记录可执行文件、对象代码、共享库、动态加载代码和内存转储的文件格式。作为 a.out 格式的替代品，Mach-O 提供了更好的扩展性，并提升了符号表中信息的访问速度。

大多数基于 Mach 内核的操作系统都使用 Mach-O。NeXTSTEP、OS X 和 iOS 是使用这种格式作为本地可执行文件、库和对象代码的例子

Mach-O 格式
Mach-O 没有类似于 XML、YAML、JSON 等诸如此类的特殊格式，它只是一个二进制字节流，被划分为了有意义的数据块。这些块包含元信息，比如，字节顺序、cpu 类型、块的大小，等等。

典型的 Mach-O 文件（对应的 官方文档 ）包含三个区域：

* 头-包含该二进制文件的一般信息：字节顺序、（魔数）、cpu 类型、加载指令的数量等等。
* 加载指令-它是一张包含很多内容的表，内容包括区域的位置、符号表、动态符号表等。每个加载指令都包含一个元信息，比如指令类型、名称、在二进制文件中的位置等等。
* 数据-通常是对象文件中最大的部分。主要包含代码、数据，例如符号表，动态符号表等等。


这里是一个简化的图形表示︰

![](http://ww3.sinaimg.cn/mw690/63918611gw1f8o4vtqj16j20c20aogn6.jpg)

OS X 有两种类型的目标文件：Mach-O 文件和通用二进制文件，也叫作胖文件。它们之间的区别是：Mach-O 文件包含一种架构（i386、x86_64、arm64 等等）的对象代码，而胖文件可能包含若干包含不同架构（i386、x86_64、arm、arm64 等等）对象代码的对象文件。

胖文件的结构相当简单︰ 胖文件头以及后面的 Mach-O 文件：
![](http://ww3.sinaimg.cn/mw690/63918611gw1f8o4vtyzozj20c40owdjr.jpg


https://www.cnblogs.com/oc-bowen/p/6000139.html
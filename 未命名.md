
---
title: 常用的锁机制
date: 2018-11-18 22:13:29
tags: iOS
------


基础锁的概念：


![](http://images.bestswifter.com/lock_benchmark.png)

信号量的锁：

``` xml
针对线程非安全的情况
#define INIT(...) self = super.init; \
if (!self) return nil; \
__VA_ARGS__; \
if (!_arr) return nil; \
_lock = dispatch_semaphore_create(1); \
return self;


#define LOCK(...) dispatch_semaphore_wait(_lock, DISPATCH_TIME_FOREVER); \
__VA_ARGS__; \
dispatch_semaphore_signal(_lock);

```
